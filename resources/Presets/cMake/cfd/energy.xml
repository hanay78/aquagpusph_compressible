<?xml version="1.0" ?>

<!-- energy.xml
Fluid energy components computation.

To use this preset you must include this file.
-->

<sphInput>
    <Variables>
        <!-- Kinetic energy -->
        <Variable name="energy_dekdt" type="float*" length="N" />
        <Variable name="energy_dEkdt" type="float" value="0.0" />
        <Variable name="energy_Ek" type="float" value="0.0" />
        <!-- Potential energy -->
        <Variable name="energy_depdt" type="float*" length="N" />
        <Variable name="energy_dEpdt" type="float" value="0.0" />
        <Variable name="energy_Ep" type="float" value="0.0" />
        <!-- Compressibility energy -->
        <Variable name="energy_decdt" type="float*" length="N" />
        <Variable name="energy_dEcdt" type="float" value="0.0" />
        <Variable name="energy_Ec" type="float" value="0.0" />
    </Variables>

    <Tools>
        <!-- Compute the energy variations per particle -->
        <Tool action="insert" before="corrector" type="kernel" name="cfd Energy" path="@RESOURCES_OUTPUT_DIR@/Scripts/cfd/Energy/Energy.cl"/>
        <!-- Sum them up to the global energy components variation -->
        <Tool action="insert" after="cfd Energy" type="reduction" name="cfd dEkdt" in="energy_dekdt" out="energy_dEkdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="cfd dEkdt" type="reduction" name="cfd dEpdt" in="energy_depdt" out="energy_dEpdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="cfd dEpdt" type="reduction" name="cfd dEcdt" in="energy_decdt" out="energy_dEcdt" null="0.f">
            c = a + b;
        </Tool>
        <!-- Integrate in time -->
        <Tool action="insert" after="cfd dEkdt" type="set_scalar" name="cfd Ek" in="energy_Ek" value="energy_Ek + dt * energy_dEkdt" />
        <Tool action="insert" after="cfd dEpdt" type="set_scalar" name="cfd Ep" in="energy_Ep" value="energy_Ep + dt * energy_dEpdt" />
        <Tool action="insert" after="cfd dEcdt" type="set_scalar" name="cfd Ec" in="energy_Ec" value="energy_Ec + dt * energy_dEcdt" />
    </Tools>
</sphInput>
